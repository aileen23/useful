<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="manager">
  <select id="emplist" resultType="map">
  	select empno,ename,deptno,position,phone from tbl_emp order by empno
  </select>
  
  <select id="emplistSearch" resultType="map">
  	select empno,ename,deptno,position,phone from tbl_emp
  	
  	<if test="searchType != null">
  		<if test="searchType =='divGbn'.toString()">
		
  		</if>
  		<if test="searchType =='name'.toString()">
  		where ename like '%'||#{keyword}||'%'
  		</if>
  		<if test="searchType =='no'.toString()">
  		where empno like '%'||#{keyword}||'%'
  		</if>
  		<if test="searchType =='dept'.toString()">
  		where deptno like '%'||#{keyword}||'%'
  		</if>
  		<if test="searchType =='posi'.toString()">
  		where position like '%'||#{keyword}||'%'
  		</if>
  		<if test="searchType =='phone'.toString()">
  		where phone like '%'||#{keyword}||'%'
  		</if>
  	
  	</if>
  	order by empno
  </select>
  
  <insert id="emp_insert">
  	insert into tbl_emp (empno,ename,pass,phone,address,hiredate,deptno,position,account,bank,email,leave,ssn)
  		values(#{empno},#{ename},#{pass},#{phone},#{address},#{hiredate},#{deptno},#{position},#{account},#{bank},#{email},15,#{ssn})
  </insert>
  
  <select id="emp_select" resultType="kr.co.useful.manager.domain.EmpVO">
  	select * from tbl_emp where empno=#{empno} 
  </select>
  
  <update id="emp_update">
  	update tbl_emp set ename=#{ename},phone=#{phone},address=#{address},hiredate=#{hiredate},deptno=#{deptno},position=#{position},account=#{account},bank=#{bank},email=#{email} where empno=#{empno} 
  </update>
  
  <delete id="emp_delete">
  	delete from tbl_emp where empno=#{empno}
  </delete>
 
  
  <select id="commute_emplist_all" resultType="kr.co.useful.manager.domain.CommuteVO">
  	select a.empno,a.ename,b.dname,a.login,a.logout,a.checked,a.serial
  	from (select emp.empno,emp.ename, emp.deptno,cmt.login,cmt.logout,cmt.checked,cmt.serial
 		 	from tbl_emp emp,(select * from tbl_commute where login between to_date(#{startdate}, 'YYYYMMDD') and to_date(#{enddate}, 'YYYYMMDD')+1) cmt
 		 	where emp.empno=cmt.empno) a, tbl_dept b
  	where a.deptno=b.deptno
  	order by a.empno
  </select>
  
  <select id="commute_emplist_empno" resultType="kr.co.useful.manager.domain.CommuteVO">
    select a.empno,a.ename,b.dname,a.login,a.logout,a.checked,a.serial
  	from (select emp.empno,emp.ename, emp.deptno,cmt.login,cmt.logout,cmt.checked,cmt.serial
 		 	from tbl_emp emp,(select * from tbl_commute where empno=#{empno} and login between to_date(#{startdate}, 'YYYYMMDD') and to_date(#{enddate}, 'YYYYMMDD')+1 ) cmt
 		 	where emp.empno=cmt.empno) a, tbl_dept b
  	where a.deptno=b.deptno
  	order by a.empno
  </select>
  
  <select id="commute_emplist_deptno" resultType="kr.co.useful.manager.domain.CommuteVO">
    select a.empno,a.ename,b.dname,a.login,a.logout,a.checked,a.serial
  	from (select emp.empno,emp.ename, emp.deptno,cmt.login,cmt.logout,cmt.checked,cmt.serial
 		 	from tbl_emp emp,(select * from tbl_commute where empno in(select empno from tbl_emp where deptno=#{deptno})
 				and login between to_date(#{startdate}, 'YYYYMMDD') and to_date(#{enddate}, 'YYYYMMDD')+1) cmt
 		 	where emp.empno=cmt.empno) a, tbl_dept b
  	where a.deptno=b.deptno
  	order by a.empno
  </select>
  
  <select id="commute_emplist_ename" resultType="kr.co.useful.manager.domain.CommuteVO">
 	select a.empno,a.ename,b.dname,a.login,a.logout,a.checked,a.serial
  	from (select emp.empno,emp.ename, emp.deptno,cmt.login,cmt.logout,cmt.checked,cmt.serial
 		 	from tbl_emp emp,( select * from tbl_commute where empno in(select empno from tbl_emp where ename=#{ename})
  				and login between to_date(#{startdate}, 'YYYYMMDD') and to_date(#{enddate}, 'YYYYMMDD')+1) cmt
 		 	where emp.empno=cmt.empno) a, tbl_dept b
  	where a.deptno=b.deptno
  	order by a.empno
  </select>
  
  <update id="commute_update">
  	update tbl_commute set login=to_date(#{login  },'YYYY-MM-DD HH24:MI:SS')
  	<if test="logout != null">
  		,logout=to_date(#{logout},'YYYY-MM-DD HH24:MI:SS')
  	</if>
  	,checked=#{checked} where serial=#{serial } 
  </update>

  <select id="commute_dept" resultType="kr.co.useful.manager.domain.CommuteVO">
    select a.empno,a.ename,b.dname,a.login,a.logout,a.checked,a.serial
  	from (select emp.empno,emp.ename, emp.deptno,cmt.login,cmt.logout,cmt.checked,cmt.serial
 		 	from tbl_emp emp,(select * from tbl_commute where empno in(select empno from tbl_emp 
 		 		<if test="deptno!=null">where deptno=#{deptno}</if> )
 				and login between to_date(#{login}, 'YYYYMM') and to_date(#{login}, 'YYYYMM')+1) cmt
 		 	where emp.empno=cmt.empno) a, tbl_dept b
  	where a.deptno=b.deptno 
  	order by a.empno
  </select>
</mapper>
